<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>People Partner Portal | Leadership Launchpad</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- User ID Verification Modal -->
    <div id="userIdModal" class="user-id-modal">
        <div class="user-id-modal-content">
            <h2>User Verification Required</h2>
            <p>Please enter your User ID to access the People Partner Portal.</p>
            <input type="text" id="userIdInput" class="user-id-input" placeholder="Enter your User ID" maxlength="7">
            <button onclick="verifyUserId()" class="verify-btn">Verify</button>
            <p id="errorMessage" class="error-msg"></p>
        </div>
    </div>

    <!-- Header -->
    <header class="header">
        <div class="header-container">
            <div class="header-title">
                <h1>People Partner Portal</h1>
            </div>
            <button class="portal-btn" onclick="logout()">Logout</button>
        </div>
    </header>

    <!-- Welcome Banner -->
    <section class="welcome-banner">
        <div class="welcome-container">
            <h2 class="welcome-title">Welcome, People Partners!</h2>
            <p class="welcome-message">You are the compass that guides associates to grow and develop. As a People Partner, you're instrumental in shaping the leadership culture, supporting career adv[...]
        </div>
    </section>

    <!-- Calendar Section -->
    <section class="calendar-section">
        <div class="calendar-container">
            <h2 class="calendar-title">2026 Calendar & Important Dates</h2>
            <p class="calendar-subtitle">Keep track of key dates and leadership initiatives throughout the year</p>
            <table class="calendar-table">
                <thead>
                    <tr>
                        <th>Date</th>
                        <th>Event</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>February 24-26, 2026</td>
                        <td>Multiple Workshops - Available Sessions</td>
                    </tr>
                    <tr>
                        <td>February 27 - March 1, 2026</td>
                        <td>Multiple Workshops - Available Sessions</td>
                    </tr>
                    <tr>
                        <td>March 2-4, 2026</td>
                        <td>YBM</td>
                    </tr>
                    <tr>
                        <td>March 14-27, 2026</td>
                        <td>Q1 Talent Reviews Due</td>
                    </tr>
                    <tr>
                        <td>March 17-19, 2026</td>
                        <td>Multiple Workshops - Available Sessions</td>
                    </tr>
                    <tr>
                        <td>March 20-22, 2026</td>
                        <td>Multiple Workshops - Available Sessions</td>
                    </tr>
                    <tr>
                        <td>April 14-16, 2026</td>
                        <td>Multiple Workshops - Available Sessions</td>
                    </tr>
                    <tr>
                        <td>April 16-18, 2026</td>
                        <td>Multiple Workshops - Available Sessions</td>
                    </tr>
                    <tr>
                        <td>April 17-19, 2026</td>
                        <td>Multiple Workshops - Available Sessions</td>
                    </tr>
                    <tr>
                        <td>April 18-20, 2026</td>
                        <td>Multiple Workshops - Available Sessions</td>
                    </tr>
                    <tr>
                        <td>May 9 - June 12, 2026</td>
                        <td>Q2 Talent Reviews Due</td>
                    </tr>
                </tbody>
            </table>
            <p style="margin-top: 20px; text-align: center;">
                <a href="https://ce.walmart.com/content/walmart-academy/en_us/home-office/quarterly-home-office-course-offerings.html" target="_blank" style="color: #5B7FFF; font-weight: 600; text-dec[...]
            </p>
        </div>
    </section>

    <!-- Mission Control Section -->
    <section id="mission-control" class="mission-section">
        <div class="mission-container">
            <h2 class="mission-title">Mission Control</h2>
            <p class="mission-note">Click buttons to learn more.</p>
            
            <!-- Mission Buttons with Content Tiles -->
            <div class="mission-buttons-section">
                <h3 class="section-title">Resources and Surveys</h3>
                <div class="mission-buttons">
                <button class="dashboard-btn active">
                    <div class="btn-content">
                        <div class="flip-card">
                            <div class="flip-card-inner">
                                <div class="flip-card-front">
                                    <h3>TAP & Roadmap</h3>
                                </div>
                                <div class="flip-card-back">
                                    <ul class="flip-links">
                                        <li><a href="TAP.pdf" target="_blank">TAP PDF</a></li>
                                        <li><a href="#" onclick="openImageModal('Roadmap.jpg'); return false;">View Roadmap</a></li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </button>
                <button class="dashboard-btn">
                    <div class="btn-content">
                        <div class="flip-card">
                            <div class="flip-card-inner">
                                <div class="flip-card-front">
                                    <h3>Templates</h3>
                                </div>
                                <div class="flip-card-back">
                                    <ul class="flip-links">
                                        <li><a href="mailto:?subject=Your%20Role%20in%20the%20Experience%20Leadership%20Development%20Program&body=Hi%20Leaders%2C%0A%0AAs%20part%20of%20our%20continued[...]
                                        <li><a href="mailto:?subject=Post%20Leader%20Academy%20Feedback%20Survey&body=Hello%20Leader%2C%0A%0AIt%20has%20been%2090%20days%20since%20your%20associate%20co[...]
                                        <li><a href="FAQs.pdf" target="_blank" download>FAQs</a></li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </button>
                <button class="dashboard-btn">
                    <div class="btn-content">
                        <div class="flip-card">
                            <div class="flip-card-inner">
                                <div class="flip-card-front">
                                    <h3>Surveys</h3>
                                </div>
                                <div class="flip-card-back">
                                    <ul class="flip-links">
                                        <li><a href="https://forms.microsoft.com/Pages/ResponsePage.aspx?id=08O8PE0JBkCYSQ0R1h9ITU2s7rvgfu5AmjciD-OGmMNUMVpQTUE3WUQ0UzFWRlRXVTNZWEgxTkRNTy4u" target="_b[...]
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </button>
            </div>
                </div>
            </div>

            <!-- Self Development Section -->
            <div class="mission-buttons-section">
                <h3 class="section-title">People Partner Data Hub</h3>
                <div class="self-dev-rectangles">
                    <a href="https://tableau-entprod.walmart.com/#/views/AMSParticipantQuery/Filters?:iid=1" target="_blank" style="text-decoration: none;">
                        <button class="rect-btn">Academy Participant Query</button>
                    </a>
                    <a href="https://forms.office.com/Pages/DesignPageV2.aspx?host=Excel_Win32&subpage=design&id=08O8PE0JBkCYSQ0R1h9ITU2s7rvgfu5AmjciD-OGmMNUMVpQTUE3WUQ0UzFWRlRXVTNZWEgxTkRNTy4u&auth_p[...]
                        <button class="rect-btn" style="background-color: #FF8C42;">Post Academy Training Results</button>
                    </a>
                </div>
                
                <!-- Last Updated Indicator -->
                <div style="text-align: center; margin: 20px 0; padding: 10px; background-color: #f0f4ff; border-radius: 8px;">
                    <p style="margin: 0; color: #5B7FFF; font-size: 14px;">
                        <strong>ðŸ“Š Data Last Refreshed:</strong> <span id="lastUpdated">Loading...</span>
                        <button id="refreshButton" onclick="refreshData()" style="margin-left: 15px; padding: 5px 15px; background-color: #5B7FFF; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 13px;">
                            ðŸ”„ Refresh Now
                        </button>
                    </p>
                </div>

                <!-- Training Attended and Effectiveness Charts Row -->
                <div class="charts-row">
                    <!-- Training Attended Chart -->
                    <div class="chart-container">
                        <h3 class="chart-title">Training Attended</h3>
                        <canvas id="trainingChart"></canvas>
                    </div>

                    <!-- Effectiveness Chart -->
                    <div class="chart-container">
                        <h3 class="chart-title">How Effective Was the Training?</h3>
                        <canvas id="effectivenessChart"></canvas>
                    </div>
                </div>

                <!-- Training Needs Chart (Full Width) -->
                <div class="chart-container-full">
                    <h3 class="chart-title">Training Gaps</h3>
                    <canvas id="trainingNeedsChart"></canvas>
                </div>
            </div>
        </div>
    </section>

    <!-- Image Modal -->
    <div id="imageModal" class="modal">
        <span class="close" onclick="closeImageModal()">&times;</span>
        <img class="modal-content" id="modalImage">
    </div>

    <script>
        // Image Modal Functions
        function openImageModal(imageSrc) {
          const modal = document.getElementById('imageModal');
          const modalImage = document.getElementById('modalImage');
          modalImage.src = imageSrc;
          modal.style.display = 'block';
          document.body.style.overflow = 'hidden';
        }

        function closeImageModal() {
          const modal = document.getElementById('imageModal');
          modal.style.display = 'none';
          document.body.style.overflow = 'auto';
        }

        // Close modal when clicking outside the image
        window.addEventListener('click', function(event) {
          const modal = document.getElementById('imageModal');
          if (event.target === modal) {
            closeImageModal();
          }
        });

        // Close modal with Escape key
        window.addEventListener('keydown', function(event) {
          if (event.key === 'Escape') {
            closeImageModal();
          }
        });

        // Logout function
        function logout() {
          if (confirm('Are you sure you want to logout?')) {
            sessionStorage.removeItem('userVerified');
            window.location.href = 'index.html';
          }
        }
    </script>

    <script>
        // User ID Verification
        const authorizedUserIds = [
            'K0J0ELD', // Kirsten Johnston
            'M0H01C4', // Michelle Acevedo
            'C0H0Q44', // Cassidy Hodges
            'K0R0K1D', // Kevin Reese
            'NSKIDMO', // Nathan Skidmore
            'C0W06X5'  // Carey Webb
        ];

        // Check if user is already verified in this session
        function checkVerification() {
            const verified = sessionStorage.getItem('userVerified');
            if (verified === 'true') {
                hideVerificationModal();
            } else {
                showVerificationModal();
            }
        }

        function showVerificationModal() {
            document.getElementById('userIdModal').style.display = 'block';
            document.body.style.overflow = 'hidden';
            // Focus on input field
            setTimeout(() => {
                document.getElementById('userIdInput').focus();
            }, 100);
        }

        function hideVerificationModal() {
            document.getElementById('userIdModal').style.display = 'none';
            document.body.style.overflow = 'auto';
        }


        function verifyUserId() {
            const userIdInput = document.getElementById('userIdInput');
            const errorMessage = document.getElementById('errorMessage');
            const enteredUserId = userIdInput.value.trim().toUpperCase();

            if (!enteredUserId) {
                errorMessage.textContent = 'Please enter a User ID.';
                return;
            }

            if (authorizedUserIds.includes(enteredUserId)) {
                sessionStorage.setItem('userVerified', 'true');
                errorMessage.textContent = '';
                hideVerificationModal();
            } else {
                errorMessage.textContent = 'Invalid User ID. Please try again.';
                userIdInput.value = '';
                userIdInput.focus();
            }
        }

        // Allow Enter key to submit
        document.addEventListener('DOMContentLoaded', function() {
            checkVerification();
            
            const userIdInput = document.getElementById('userIdInput');
            if (userIdInput) {
                userIdInput.addEventListener('keypress', function(event) {
                    if (event.key === 'Enter') {
                        verifyUserId();
                    }
                });
            }
        });
    </script>

    <!-- Chart.js Library -->
    <script src="./chart.js"></script>
    
    <script>
        // Store chart instances to allow destruction on reload
        let trainingChartInstance = null;
        let effectivenessChartInstance = null;
        let trainingNeedsChartInstance = null;

        // Fetch survey data and create charts
        document.addEventListener('DOMContentLoaded', function() {
            // Load data initially
            loadSurveyData();
        });

        // Function to load survey data with aggressive cache busting
        function loadSurveyData() {
            // Generate a unique timestamp for cache busting
            const timestamp = new Date().getTime();
            const randomNum = Math.random();
            const cacheKey = `${timestamp}_${randomNum}`;
            
            console.log('Loading survey data with cache key:', cacheKey);
            
            // Multiple cache-busting mechanisms to ensure fresh data
            return fetch(`./combinedSurveyData.json?t=${cacheKey}`, {
                method: 'GET',
                cache: 'no-store',
                headers: {
                    'Cache-Control': 'no-cache, no-store, must-revalidate, max-age=0',
                    'Pragma': 'no-cache',
                    'Expires': '0'
                }
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                return response.json();
            })
            .then(data => {
                console.log('Survey data loaded successfully:', data);
                
                // Destroy existing charts before creating new ones
                destroyAllCharts();
                
                // Create new charts with fresh data
                createTrainingChart(data);
                createEffectivenessChart(data);
                createTrainingNeedsChart(data);
                
                // Update the timestamp display
                updateLastUpdatedTime();
                
                return data; // Return data for promise chain
            })
            .catch(error => {
                console.error('Error loading survey data:', error);
                displayDataLoadError();
                throw error; // Re-throw for promise chain
            });
        }

        // Destroy all chart instances
        function destroyAllCharts() {
            if (trainingChartInstance) {
                trainingChartInstance.destroy();
                trainingChartInstance = null;
            }
            if (effectivenessChartInstance) {
                effectivenessChartInstance.destroy();
                effectivenessChartInstance = null;
            }
            if (trainingNeedsChartInstance) {
                trainingNeedsChartInstance.destroy();
                trainingNeedsChartInstance = null;
            }
            console.log('All charts destroyed');
        }

        // Update the last updated timestamp
        function updateLastUpdatedTime() {
            const now = new Date();
            const formattedTime = now.toLocaleString('en-US', {
                month: 'short',
                day: 'numeric',
                year: 'numeric',
                hour: 'numeric',
                minute: '2-digit',
                hour12: true
            });
            const lastUpdatedElement = document.getElementById('lastUpdated');
            if (lastUpdatedElement) {
                lastUpdatedElement.textContent = formattedTime;
                lastUpdatedElement.style.color = '#5B7FFF';
            }
            console.log('Last updated time set to:', formattedTime);
        }

        // Display error message if data fails to load
        function displayDataLoadError() {
            const lastUpdatedElement = document.getElementById('lastUpdated');
            if (lastUpdatedElement) {
                lastUpdatedElement.textContent = 'Error loading data';
                lastUpdatedElement.style.color = '#ff0000';
            }
        }

        // Reload data when page becomes visible (user switches back to tab)
        document.addEventListener('visibilitychange', function() {
            if (!document.hidden) {
                console.log('Page became visible - refreshing data');
                loadSurveyData();
            }
        });

        // Function to refresh data manually (called by button)
        function refreshData() {
            console.log('Manual refresh triggered by button click');
            const button = document.getElementById('refreshButton');
            
            // Disable button and show loading state
            button.disabled = true;
            button.innerHTML = 'ðŸ”„ Refreshing...';
            button.style.backgroundColor = '#7B9FFF';
            
            // Load fresh data from combinedSurveyData.json
            loadSurveyData()
                .then(() => {
                    // Success - show success state briefly
                    console.log('Refresh completed successfully');
                    button.innerHTML = 'âœ“ Refreshed!';
                    button.style.backgroundColor = '#2DB84B';
                    
                    setTimeout(() => {
                        button.innerHTML = 'ðŸ”„ Refresh Now';
                        button.style.backgroundColor = '#5B7FFF';
                        button.disabled = false;
                    }, 1500);
                })
                .catch((error) => {
                    // Error - show error state
                    console.error('Refresh failed:', error);
                    button.innerHTML = 'âŒ Refresh Failed';
                    button.style.backgroundColor = '#ff6b6b';
                    
                    setTimeout(() => {
                        button.innerHTML = 'ðŸ”„ Refresh Now';
                        button.style.backgroundColor = '#5B7FFF';
                        button.disabled = false;
                    }, 2000);
                });
        }

        // Auto-refresh data every 5 minutes (300000ms)
        setInterval(function() {
            console.log('Auto-refresh triggered (5-minute interval)');
            loadSurveyData();
        }, 300000);

        // Training Attended Doughnut Chart
        function createTrainingChart(data) {
            const ctx = document.getElementById('trainingChart');
            if (!ctx) {
                console.error('Training chart canvas not found');
                return;
            }
            
            trainingChartInstance = new Chart(ctx.getContext('2d'), {
                type: 'doughnut',
                data: {
                    labels: ['New Leaders', 'Leading Individual Contributors', 'Leading Leaders'],
                    datasets: [{
                        data: [
                            data.trainingAttended.newLeaders || 0,
                            data.trainingAttended.leadingIndividualContributors || 0,
                            data.trainingAttended.leadingLeaders || 0
                        ],
                        backgroundColor: [
                            '#5B7FFF',
                            '#FF1493',
                            '#20B2AA'
                        ],
                        borderColor: [
                            '#4A6BE6',
                            '#E60D7B',
                            '#1A9A8F'
                        ],
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: {
                            position: 'left',
                            labels: {
                                font: { size: 14, weight: '600' },
                                padding: 20,
                                color: '#333',
                                usePointStyle: true
                            }
                        }
                    }
                }
            });
            console.log('Training chart created');
        }

        // Effectiveness Rating Bar Chart
        function createEffectivenessChart(data) {
            const ctx = document.getElementById('effectivenessChart');
            if (!ctx) {
                console.error('Effectiveness chart canvas not found');
                return;
            }
            
            effectivenessChartInstance = new Chart(ctx.getContext('2d'), {
                type: 'bar',
                data: {
                    labels: ['Very Effective', 'Somewhat Effective', 'Neutral', 'Somewhat Ineffective', 'Neither'],
                    datasets: [{
                        label: 'Responses',
                        data: [
                            data.effectiveness.veryEffective || 0,
                            data.effectiveness.somewhatEffective || 0,
                            data.effectiveness.neutral || 0,
                            data.effectiveness.somewhatIneffective || 0,
                            data.effectiveness.neitherEffectiveNorIneffective || 0
                        ],
                        backgroundColor: [
                            '#2DB84B',
                            '#5B7FFF',
                            '#FFB820',
                            '#FF8C42',
                            '#FF1493'
                        ],
                        borderRadius: 8,
                        borderSkipped: false
                    }]
                },
                options: {
                    indexAxis: 'y',
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        x: {
                            beginAtZero: true,
                            ticks: {
                                stepSize: 1
                            }
                        }
                    }
                }
            });
            console.log('Effectiveness chart created');
        }

        // Training Needs Vertical Bar Chart
        function createTrainingNeedsChart(data) {
            const ctx = document.getElementById('trainingNeedsChart');
            if (!ctx) {
                console.error('Training needs chart canvas not found');
                return;
            }
            
            trainingNeedsChartInstance = new Chart(ctx.getContext('2d'), {
                type: 'bar',
                data: {
                    labels: [
                        'Communication',
                        'Decision Making & Problem Solving',
                        'Team Building',
                        'Healthy Conflict',
                        'Strategic Thinking',
                        'Feedback & Coaching',
                        'Development Ownership & IDP',
                        'Career Conversations',
                        'Emotional Intelligence & Self-Awareness',
                        'Personal Brand & Presence',
                        'Navigating Change & Ambiguity',
                        'Influence & Persuasion',
                        'Negotiations',
                        'Rest & Resilience',
                        'Career Navigation'
                    ],
                    datasets: [{
                        label: 'Number of Selections',
                        data: [
                            data.trainingNeeds.communication || 0,
                            data.trainingNeeds.decisionMakingProblemSolving || 0,
                            data.trainingNeeds.teamBuilding || 0,
                            data.trainingNeeds.healthyConflict || 0,
                            data.trainingNeeds.strategicThinking || 0,
                            data.trainingNeeds.feedbackCoaching || 0,
                            data.trainingNeeds.developmentOwnershipIDP || 0,
                            data.trainingNeeds.careerConversations || 0,
                            data.trainingNeeds.emotionalIntelligenceSelfAwareness || 0,
                            data.trainingNeeds.personalBrandPresence || 0,
                            data.trainingNeeds.navigatingChangeAmbiguity || 0,
                            data.trainingNeeds.influencePersuasion || 0,
                            data.trainingNeeds.negotiations || 0,
                            data.trainingNeeds.restResilience || 0,
                            data.trainingNeeds.careerNavigation || 0
                        ],
                        backgroundColor: [
                            '#0066CC',
                            '#5B7FFF',
                            '#FF1493',
                            '#20B2AA',
                            '#FFB820',
                            '#FF8C42',
                            '#9C27B0',
                            '#4CAF50',
                            '#F44336',
                            '#00BCD4',
                            '#FFC107',
                            '#795548',
                            '#607D8B',
                            '#E91E63',
                            '#3F51B5'
                        ],
                        borderRadius: 8,
                        borderSkipped: false
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                stepSize: 1
                            }
                        },
                        x: {
                            ticks: {
                                autoSkip: false,
                                maxRotation: 45,
                                minRotation: 45
                            }
                        }
                    }
                }
            });
            console.log('Training needs chart created');
        }
    </script>

</body>
</html>
